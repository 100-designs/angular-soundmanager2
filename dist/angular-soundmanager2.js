/*! angular-soundmanager2 04-02-2015 */
var ngSoundManager=angular.module("angularSoundManager",[]);ngSoundManager.filter("humanTime",function(){return function(a){function b(a){return 10>a?"0"+a.toString():a.toString()}var c=a/1e3/60<<0,d=Math.round(a/1e3%60);return b(c)+":"+b(d)}}),ngSoundManager.factory("angularPlayer",["$rootScope",function(a){var b=null,c=!1,d=!0,e=!1,f=90,g=0,h=[];return{init:function(){"undefined"==typeof soundManager&&alert("Please include SoundManager2 Library!"),soundManager.setup({preferFlash:!1,debugMode:!1,useHTML5Audio:!0,onready:function(){},ontimeout:function(){alert("SM2 failed to start. Flash missing, blocked or security error?"),alert("The status is "+status.success+", the error type is "+status.error.type)},defaultOptions:{autoLoad:!1,autoPlay:!1,from:null,loops:1,multiShot:!1,multiShotEvents:!1,onid3:null,onload:null,onstop:null,onfailure:"nextTrack",onpause:null,onplay:null,onresume:null,position:null,pan:0,stream:!0,to:null,type:"audio/mp3",usePolicyFile:!1,volume:f,whileloading:function(){},whileplaying:function(){b=this.id,g=this.position/this.duration*100,a.$broadcast("track:progress",g),a.$broadcast("currentTrack:position",this.position),a.$broadcast("currentTrack:duration",this.duration)},onfinish:function(){if(soundManager._writeDebug(this.id+" finished playing"),d===!0){var c=angular.element(document.querySelector("[ng-app]")),e=c.injector(),f=e.get("angularPlayer");f.nextTrack(),a.$broadcast("track:id",b)}}}}),soundManager.onready(function(){console.log("song manager ready!");var b=soundManager.ok();console.log("is supported: "+b),a.$broadcast("angularPlayer:ready",!0)})},isInArray:function(a,b){for(var c=0;c<a.length;c++)if(a[c].id===b)return c;return!1},getIndexByValue:function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return!1},asyncLoop:function(a){var b=-1,c=function(){return b++,b==a.length?void a.callback():void a.functionToLoop(c,b)};c()},setCurrentTrack:function(a){b=a},getCurrentTrack:function(){return b},currentTrackData:function(){var a=this.getCurrentTrack(),b=this.isInArray(h,a);return h[b]},getPlaylist:function(a){return"undefined"==typeof a?h:h[a]},addToPlaylist:function(b){h.push(b),a.$broadcast("player:playlist",h)},addTrack:function(a){if(soundManager.canPlayURL(a.url)!==!0)return console.log("invalid song url"),null;var b=this.isInArray(this.getPlaylist(),a.id);return b===!1&&(console.log("song does not exists in playlist"),soundManager.createSound({id:a.id,url:a.url}),this.addToPlaylist(a)),a.id},removeSong:function(c,d){c===b&&this.stop(),soundManager.destroySound(c),h.splice(d,1),a.$broadcast("player:playlist",h)},initPlayTrack:function(b,c){c!==!0&&(this.stop(),this.setCurrentTrack(b)),soundManager.play(b),a.$broadcast("track:id",b),e=!0,a.$broadcast("music:isPlaying",e)},play:function(){var a=null;if(null===this.getCurrentTrack()){if(0===soundManager.soundIDs.length)return void console.log("playlist is empty!");a=soundManager.soundIDs[0],this.initPlayTrack(a)}else a=this.getCurrentTrack(),this.initPlayTrack(a,!0)},pause:function(){soundManager.pause(this.getCurrentTrack()),e=!1,a.$broadcast("music:isPlaying",e)},stop:function(){this.pause(),this.resetProgress(),a.$broadcast("track:progress",g),a.$broadcast("currentTrack:position",0),a.$broadcast("currentTrack:duration",0),soundManager.stopAll(),soundManager.unload(this.getCurrentTrack())},playTrack:function(a){this.initPlayTrack(a)},nextTrack:function(){var b=this.getIndexByValue(soundManager.soundIDs,this.getCurrentTrack()),d=+b+1,f=soundManager.soundIDs[d];"undefined"!=typeof f?this.playTrack(f):c===!0?this.playTrack(soundManager.soundIDs[0]):(e=!1,a.$broadcast("music:isPlaying",e))},prevTrack:function(){var a=this.getIndexByValue(soundManager.soundIDs,this.getCurrentTrack()),b=+a-1,c=soundManager.soundIDs[b];"undefined"!=typeof c?this.playTrack(c):console.log("no prev track found!")},mute:function(){soundManager.muted===!0?soundManager.unmute():soundManager.mute(),a.$broadcast("music:mute",soundManager.muted)},getMuteStatus:function(){return soundManager.muted},repeatToggle:function(){c=c===!0?!1:!0,a.$broadcast("music:repeat",c)},getRepeatStatus:function(){return c},getVolume:function(){return f},adjustVolume:function(b){var c=function(b){for(var c=0;c<soundManager.soundIDs.length;c++){var d=soundManager.getSoundById(soundManager.soundIDs[c]);d.setVolume(b)}a.$broadcast("music:volume",b)};b===!0?100>f&&(f+=10,c(f)):f>0&&(f-=10,c(f))},clearPlaylist:function(b){console.log("clear playlist"),this.resetProgress();var c=soundManager.soundIDs.length;this.asyncLoop({length:c,functionToLoop:function(a){setTimeout(function(){soundManager.destroySound(soundManager.soundIDs[0]),a()},100)},callback:function(){console.log("All done!"),h=[],a.$broadcast("player:playlist",h),b(!0)}})},resetProgress:function(){g=0}}}]),ngSoundManager.directive("soundManager",["$filter","angularPlayer",function(a,b){return{restrict:"E",link:function(c){b.init(),c.$on("track:progress",function(a,b){c.$apply(function(){c.progress=b})}),c.$on("track:id",function(){c.$apply(function(){c.currentPlaying=b.currentTrackData()})}),c.$on("currentTrack:position",function(b,d){c.$apply(function(){c.currentPostion=a("humanTime")(d)})}),c.$on("currentTrack:duration",function(b,d){c.$apply(function(){c.currentDuration=a("humanTime")(d)})}),c.isPlaying=!1,c.$on("music:isPlaying",function(a,b){c.$apply(function(){c.isPlaying=b})}),c.playlist=b.getPlaylist(),c.$on("player:playlist",function(a,b){c.$apply(function(){c.playlist=b})})}}}]),ngSoundManager.directive("musicPlayer",["angularPlayer",function(a){return{restrict:"EA",scope:{song:"=addSong"},link:function(b,c,d){var e=function(){var c=a.addTrack(b.song);"play"===d.musicPlayer&&a.playTrack(c)};c.bind("click",function(){console.log("adding song to playlist"),e()})}}}]),ngSoundManager.directive("playFromPlaylist",["angularPlayer",function(a){return{restrict:"EA",scope:{song:"=playFromPlaylist"},link:function(b,c){c.bind("click",function(){a.playTrack(b.song.id)})}}}]),ngSoundManager.directive("removeFromPlaylist",["angularPlayer",function(a){return{restrict:"EA",scope:{song:"=removeFromPlaylist"},link:function(b,c,d){c.bind("click",function(){a.removeSong(b.song.id,d.index)})}}}]),ngSoundManager.directive("seekTrack",["angularPlayer",function(a){return{restrict:"EA",link:function(b,c){c.bind("click",function(b){if(null===a.getCurrentTrack())return void console.log("no track loaded");var d=soundManager.getSoundById(a.getCurrentTrack()),e=function(a){for(var b=0,c=a.target;c&&!isNaN(c.offsetLeft)&&!isNaN(c.offsetTop);)b+=c.offsetLeft-c.scrollLeft,c=c.offsetParent;return a.clientX-b},f=b.offsetX||e(b),g=c[0].clientWidth,h=d.durationEstimate;d.setPosition(f/g*h)})}}}]),ngSoundManager.directive("playMusic",["angularPlayer",function(a){return{restrict:"EA",link:function(b,c){c.bind("click",function(){a.play()})}}}]),ngSoundManager.directive("pauseMusic",["angularPlayer",function(a){return{restrict:"EA",link:function(b,c){c.bind("click",function(){a.pause()})}}}]),ngSoundManager.directive("stopMusic",["angularPlayer",function(a){return{restrict:"EA",link:function(b,c){c.bind("click",function(){a.stop()})}}}]),ngSoundManager.directive("nextTrack",["angularPlayer",function(a){return{restrict:"EA",link:function(b,c){c.bind("click",function(){a.nextTrack()})}}}]),ngSoundManager.directive("prevTrack",["angularPlayer",function(a){return{restrict:"EA",link:function(b,c){c.bind("click",function(){a.prevTrack()})}}}]),ngSoundManager.directive("muteMusic",["angularPlayer",function(a){return{restrict:"EA",link:function(b,c){c.bind("click",function(){a.mute()}),b.mute=a.getMuteStatus(),b.$on("music:mute",function(a,c){b.$apply(function(){b.mute=c})})}}}]),ngSoundManager.directive("repeatMusic",["angularPlayer",function(a){return{restrict:"EA",link:function(b,c){c.bind("click",function(){a.repeatToggle()}),b.repeat=a.getRepeatStatus(),b.$on("music:repeat",function(a,c){b.$apply(function(){b.repeat=c})})}}}]),ngSoundManager.directive("musicVolume",["angularPlayer",function(a){return{restrict:"EA",link:function(b,c,d){c.bind("click",function(){a.adjustVolume("increase"===d.type?!0:!1)}),b.volume=a.getVolume(),b.$on("music:volume",function(a,c){b.$apply(function(){b.volume=c})})}}}]),ngSoundManager.directive("clearPlaylist",["angularPlayer",function(a){return{restrict:"EA",link:function(b,c){c.bind("click",function(){a.stop(),a.setCurrentTrack(null),a.clearPlaylist(function(){console.log("all clear!")})})}}}]),ngSoundManager.directive("playAll",["angularPlayer",function(a){return{restrict:"EA",scope:{songs:"=playAll"},link:function(b,c){c.bind("click",function(){a.clearPlaylist(function(){console.log("cleared, ok now add to playlist");for(var c=0;c<b.songs.length;c++)a.addTrack(b.songs[c]);a.play()})})}}}]);